<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 - Précision Atomique</title>
    <style>
        body {
            background: #000;
            color: #fff;
            font-family: 'Helvetica', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        #countdown {
            font-size: clamp(5rem, 20vw, 12rem);
            font-weight: 900;
            font-variant-numeric: tabular-nums; /* Évite que les chiffres bougent */
        }

        .controls { position: fixed; bottom: 20px; display: flex; gap: 10px; }
        
        button {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }

        #startBtn { background: #00ff88; }
        #testBtn { background: #333; color: white; }

        .new-year {
            display: none;
            font-size: 5rem;
            text-align: center;
            color: #ffd700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            animation: zoom 0.5s ease-out;
        }

        @keyframes zoom { from { transform: scale(0.5); } to { transform: scale(1); } }
        .flash { background: white !important; }
    </style>
</head>
<body>

    <div id="countdown">PRÊT ?</div>
    <div id="newYearMessage" class="new-year">✨ 2026 ✨<br>BONNE ANNÉE !</div>

    <div class="controls">
        <button id="startBtn">DÉMARRER LE DIRECT</button>
        <button id="testBtn">TESTER (10s)</button>
    </div>

    <script>
        const countdownEl = document.getElementById('countdown');
        const messageEl = document.getElementById('newYearMessage');
        const synth = window.speechSynthesis;
        
        let lastSecond = -1;
        let isTest = false;
        let testTarget = 0;

        function speak(text) {
            // Force l'arrêt de la voix précédente pour éviter le cumul
            synth.cancel();
            const utter = new SpeechSynthesisUtterance(text);
            utter.lang = 'fr-FR';
            utter.rate = 1.3; // Un peu plus vif
            synth.speak(utter);
        }

        function tick() {
            const now = Date.now();
            // Si mode test, on compte 10s à partir du clic, sinon 1er Janvier
            const target = isTest ? testTarget : new Date('January 1, 2026 00:00:00').getTime();
            const diff = target - now;

            if (diff <= 0) {
                countdownEl.style.display = 'none';
                messageEl.style.display = 'block';
                if (lastSecond !== 0) {
                    speak("Bonne année deux mille vingt-six !");
                    lastSecond = 0;
                }
                return;
            }

            const totalSeconds = Math.floor(diff / 1000);
            
            // On ne déclenche l'action que si la seconde a CHANGÉ
            if (totalSeconds !== lastSecond) {
                lastSecond = totalSeconds;

                // Affichage
                if (totalSeconds > 60 && !isTest) {
                    const mins = Math.floor(totalSeconds / 60);
                    const secs = totalSeconds % 60;
                    countdownEl.innerText = `${mins}:${secs.toString().padStart(2, '0')}`;
                } else {
                    countdownEl.innerText = totalSeconds;
                }

                // Voix et Flash (10 secondes finales)
                if (totalSeconds <= 10) {
                    speak(totalSeconds.toString());
                    document.body.classList.add('flash');
                    setTimeout(() => document.body.classList.remove('flash'), 50);
                }
            }

            requestAnimationFrame(tick);
        }

        document.getElementById('startBtn').onclick = () => {
            isTest = false;
            lastSecond = -1;
            document.querySelector('.controls').style.display = 'none';
            tick();
        };

        document.getElementById('testBtn').onclick = () => {
            isTest = true;
            testTarget = Date.now() + 11000; // 11 secondes pour voir le "10"
            lastSecond = -1;
            messageEl.style.display = 'none';
            countdownEl.style.display = 'block';
            tick();
        };
    </script>
</body>
</html>
